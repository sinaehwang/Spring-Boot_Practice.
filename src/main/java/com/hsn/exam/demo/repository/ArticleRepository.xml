<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace = "com.hsn.exam.demo.repository.ArticleRepository">

	<insert id ="writeArticle" >
	INSERT INTO article SET 
	regDate = NOW(),
	updateDate = NOW(),
	memberId = #{memberId}, 
	boardId = #{boardId},
	title = #{title}, 
	`body` =#{body}
	</insert>
	
	<select id="getForPrintArticle" resultType = "Article">
	SELECT article.*,`member`.nickname 
	AS extra_writerName 
	FROM article 
	LEFT JOIN `member` 
	ON article.memberId = `member`.Id
	WHERE article.id = #{id}
	</select>
	
	<delete id ="deleteArticle">
	DELETE FROM article WHERE id = #{id}
	</delete>
	
	<update id ="modifyArticle">
	UPDATE article 
	<set> 
	<if test = "title !=null and title !=''" > 
	title = #{title} ,
	</if>
	<if test = "body != null and body !=''"> 
	`body` = #{body},
	</if>
	updateDate = NOW()
	</set> 
	WHERE id = #{id}
	</update>
	
	<select id ="getArticles" resultType = "Article"> 
	SELECT article.*,`member`.nickname 
	AS extra_writerName 
	FROM article LEFT JOIN `member` 
	ON article.memberId = `member`.Id
	WHERE 1=1
	<if test = "boardId !=0" >
		AND article.boardId = #{boardId}
	</if>
	ORDER BY article.id DESC
	<if test = "lastPage !=-1" > <!-- 페이지값 오류를 방지하기위해 if로 막아줌(정상값을 받았을경우에만 실행되도록) -->
	LIMIT #{startPage}, #{lastPage}
	</if>
	</select>
	
	<select id = "getLastInsertId" resultType = "int">
	SELECT LAST_INSERT_ID()
	</select>

</mapper>

